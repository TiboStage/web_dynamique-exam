{% extends 'base.html.twig' %}
{% block title %}Utilisateurs - Admin{% endblock %}
{% block body %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-lg-2 mb-4">
            <div class="card bg-dark text-white"><div class="card-body p-3">
                <h6 class="text-uppercase text-muted-light mb-3">Admin</h6>
                <nav class="nav flex-column">
                    <a class="nav-link" href="{{ path('app_admin_dashboard') }}"><i class="bi bi-speedometer2"></i> Dashboard</a>
                    <a class="nav-link active" href="{{ path('app_admin_users') }}"><i class="bi bi-people"></i> Utilisateurs</a>
                </nav>
            </div></div>
        </div>
        <div class="col-lg-10">
            <h1 class="mb-4"><i class="bi bi-people me-2"></i>Utilisateurs</h1>
            <div class="card mb-4"><div class="card-body">
                <form method="get" class="row g-3">
                    <div class="col-md-9"><input type="text" name="search" class="form-control" placeholder="Rechercher..." value="{{ search }}"></div>
                    <div class="col-md-3"><button type="submit" class="btn btn-primary w-100"><i class="bi bi-search"></i> Rechercher</button></div>
                </form>
            </div></div>
            <div class="card"><div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead><tr><th>ID</th><th>Utilisateur</th><th>Email</th><th>RÃ´le</th><th>Statut</th><th>Actions</th></tr></thead>
                    <tbody>
                        {% for user in users %}
                        <tr>
                            <td>{{ user.id }}</td>
                            <td><a href="{{ path('app_admin_user_show', {id: user.id}) }}">{{ user.username }}</a></td>
                            <td>{{ user.email }}</td>
                            <td>{% if user.isAdmin %}<span class="badge bg-danger">Admin</span>{% else %}<span class="badge bg-secondary">User</span>{% endif %}</td>
                            <td>{% if user.isBanned %}<span class="badge bg-danger">Banni</span>{% else %}<span class="badge bg-success">Actif</span>{% endif %}</td>
                            <td>
                                <a href="{{ path('app_admin_user_show', {id: user.id}) }}" class="btn btn-sm btn-outline-primary"><i class="bi bi-eye"></i></a>
                                {% if user != app.user %}
                                    {% if user.isBanned %}
                                    <form action="{{ path('app_admin_user_unban', {id: user.id}) }}" method="post" class="d-inline">
                                        <input type="hidden" name="_token" value="{{ csrf_token('unban-user-' ~ user.id) }}">
                                        <button class="btn btn-sm btn-outline-success"><i class="bi bi-person-check"></i></button>
                                    </form>
                                    {% else %}
                                    <form action="{{ path('app_admin_user_ban', {id: user.id}) }}" method="post" class="d-inline">
                                        <input type="hidden" name="_token" value="{{ csrf_token('ban-user-' ~ user.id) }}">
                                        <button class="btn btn-sm btn-outline-danger"><i class="bi bi-person-x"></i></button>
                                    </form>
                                    {% endif %}
                                {% endif %}
                            </td>
                        </tr>
                        {% else %}
                        <tr><td colspan="6" class="text-center py-4">Aucun utilisateur</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div></div>
        </div>
    </div>
</div>
{% endblock %}
